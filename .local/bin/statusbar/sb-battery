#!/bin/sh

# This script prints all attached batteries, their percentage remaining, 
# and an emoji corresponding to their charge status.
# It also handles mouse scroll to adjust screen brightness and opens the script in an editor on click.

# Notification with battery status legends when right-clicked
case $BLOCK_BUTTON in
    3) notify-send "ğŸ”‹ Battery module" "ğŸ”‹: discharging
ğŸ›‘: not charging
â™»: stagnant charge
ğŸ”Œ: charging
âš¡: charged
â—: battery very low!
- Scroll to change adjust xbacklight." ;;
    4) xbacklight -inc 10 ;;  # Increase screen brightness
    5) xbacklight -dec 10 ;;  # Decrease screen brightness
    6) "$TERMINAL" -e "$EDITOR" "$0" ;;  # Open this script in an editor
esac

# Loop through all attached batteries and format the information
for battery in /sys/class/power_supply/BAT?*; do
    # If this isn't the first battery, print a space separator
    [ -n "${capacity+x}" ] && printf " "
    
    # Read the current status and capacity from system files
    status=$(cat "$battery/status" 2>&1)
    capacity=$(cat "$battery/capacity" 2>&1)
    
    # Determine the status emoji
    case "$status" in
        "Full") status_emoji="âš¡" ;;
        "Discharging") status_emoji="ğŸ”‹" ;;
        "Charging") status_emoji="ğŸ”Œ" ;;
        "Not charging") status_emoji="ğŸ›‘" ;;
        "Unknown") status_emoji="â™»" ;;
        *) exit 1 ;;  # Exit on unexpected status
    esac
    
    # Determine if a low battery warning is needed
    [ "$status_emoji" = "ğŸ”‹" ] && [ "$capacity" -le 25 ] && warn="â—"
    
    # Print the battery status and capacity
    printf "%s%s%d%%" "$status_emoji" "$warn" "$capacity"
    unset warn  # Clear the warning for the next battery
done

# Ensure the output ends with a newline character
printf "\n"
